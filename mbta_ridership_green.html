<!DOCTYPE html>
<html lang="en">
    <title>CS 416 Narrative Visualization Project</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <script src="js/weekly_gates_green_line.js"></script>
    <script src="js/weekly_station_gates_green_line.js"></script>
    <style>
        path {
            fill:none;
            stroke:black;
        }
        .mytooltip{
            visibility: hidden;
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 250px;
            overflow: hidden;
        }
        circle {
            fill:transparent;
        }
        p {
            margin-left: 150px;
            margin-right: 150px;
        }
        .flex_container {
            margin: auto;
            display: flex;
            align-items: center;
            width: 70%;
            justify-content: center;
        }
    </style>
    <div id="tooltip" class="mytooltip"></div>
    <body>
        <h1 style="text-align:center">CS416 Narrative Visualization Project</h1>
        <h2 style="text-align:center">Ridership on the MBTA</h2>

        <p style="text-align: center" width="500">Hover over the line for details at each week. Click on each individual route in the buttons below to see charts detailing each route's ridership. Each route has different details. Additional data is available at an individual station level using the dropdown below the chart.</p>

        <p style="text-align:center">
            <button id="systemwideButton" onclick="window.location.href='https://dbloxham1.github.io/mbta_ridership.html'">Systemwide</button>
            <button id="redButton" onclick="window.location.href='https://dbloxham1.github.io/mbta_ridership_red.html'">Red</button>
            <button id="orangeButton" onclick="window.location.href='https://dbloxham1.github.io/mbta_ridership_orange.html'">Orange</button>
            <button id="greenButton" onclick="window.location.href='https://dbloxham1.github.io/mbta_ridership_green.html'">Green</button>
            <button id="blueButton" onclick="window.location.href='https://dbloxham1.github.io/mbta_ridership_blue.html'">Blue</button>
        </p>
        <div id="green" style="text-align:center"></div>
        <script>
            initialChart();
            function update(stationName) {
                d3.select('#green').html('');
                if (stationName === "") {
                    initialChart();
                } else {
                    updateChart(stationName);
                }
            };
            function resetChart() {
                d3.select('#green').html('');
                initialChart();
                let branchSelect = document.getElementById('branch');
                let stationSelect = document.getElementById('stationChoice');
                branchSelect.value = "";
                stationSelect.value = "";
            }
        </script>
        <div class="flex_container">
            <label>Branch:&nbsp;</label>
            <select id="branch">
                <option value="">All Branches</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
            </select>
            &nbsp; 
            <label>Station:&nbsp;</label>
            <select id="stationChoice" onchange="update(value)">
                <option value="">All Stations</option>
            </select>
            &nbsp;
            <button id="resetChartButton" onclick="resetChart()">Reset Chart</button>
            <script>
                document.getElementById('branch').addEventListener('change',function(){
                    var stationChoice = document.getElementById('stationChoice');
                    stationChoice.innerHTML = "";

                    if (this.value === "B") {
                        var options = ['All Stations', 'Government Center','Park Street', 'Boylston', 'Arlington', 'Copley', 'Hynes Convention Center', 'Kenmore', 'Blandford Street', 'Boston University East', 'Boston University Central', 'Amory Street', 'Babcock Street', "Packard's Corner", 'Harvard Avenue', 'Griggs Street', 'Allston Street', 'Warren Street', 'Washington Street', 'Sutherland Road', 'Chiswick Road', 'Chestnut Hill Avenue', 'South Street', 'Boston College'];
                    } else if (this.value === "C") {
                        var options = ['All Stations', 'Government Center','Park Street', 'Boylston', 'Arlington', 'Copley', 'Hynes Convention Center', 'Kenmore', "Saint Mary's Street", 'Hawes Street', 'Kent Street', 'Saint Paul Street', 'Coolidge Corner', 'Summit Avenue', 'Brandon Hall', 'Fairbanks Street', 'Washington Square', 'Tappan Street', 'Dean Road', 'Englewood Avenue', 'Cleveland Circle'];
                    } else if (this.value === "D") {
                        var options = ['All Stations', 'Union Square', 'Lechmere', 'Science Park/West End', 'North Station', 'Haymarket', 'Government Center','Park Street', 'Boylston', 'Arlington', 'Copley', 'Hynes Convention Center', 'Kenmore', 'Fenway', 'Longwood', 'Brookline Village', 'Brookline Hills', 'Beaconsfield', 'Reservoir', 'Chestnut Hill', 'Newton Centre', 'Newton Highlands', 'Eliot', 'Waban', 'Woodland', 'Riverside'];
                    } else if (this.value === "E") {
                        var options = ['All Stations', 'Medford/Tufts', 'Ball Square', 'Magoun Square', 'Gilman Square', 'East Somerville', 'Lechmere', 'Science Park/West End', 'North Station', 'Haymarket', 'Government Center','Park Street', 'Boylston', 'Arlington', 'Copley', 'Prudential', 'Symphony', 'Northeastern University', 'Museum of Fine Arts', 'Longwood Medical Area', 'Brigham Circle', 'Fenwood Road', 'Mission Park', 'Riverway', 'Back of the Hill', 'Heath Street'];
                    } else { var options = ['All Stations']; }
                    for(var i = 0; i < options.length; i++) {
                        var opt = document.createElement('option');
                        if (options[i] === 'All Stations') {
                            opt.value = "";
                        } else if (options[i] === 'Science Park/West End') {
                            opt.value = "Science Park";
                        } else {
                            opt.value = options[i];
                        }
                        opt.innerHTML = options[i];
                        stationChoice.appendChild(opt);
                    }
                });
            </script>
        </div>

        <p style="text-align:center" width="500">Note: Some stations available here do not have data available as they do not require gate access to board. This includes any station west of Kenmore (or Prudential if on the E branch).</p>

        <p style="text-align:center" width="500">Additionally, since the opening of the Green Line Extension, stations between Lechmere and Union Square or Medford/Tufts have operated under a validation system where riders can validate their ticket before boarding, however there is no gate restricting them from boarding at these stations. Therefore,gated entries is not a useful metric in evaluating ridership at these stations.</p>

        <p style="text-align:center" width="500">A gated entry is defined as a successful smart card tap or ticket insertion recorded at a faregate. More details on data definitions can be found <a href="https://mbta-massdot.opendata.arcgis.com/datasets/mbta-gated-station-entries-historical/about" target="_blank" rel="noopener noreferrer">here</a>.</p>

        <p style="text-align: center;" width="500">Data Source: <a href="https://mbta-massdot.opendata.arcgis.com/datasets/mbta-gated-station-entries-historical/about" target="_blank" rel="noopener noreferrer">MBTA Gated Station Entries - Historical</a></p>
    </body>
</html>
